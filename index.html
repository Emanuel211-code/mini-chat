<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Mini Chat</title>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body {
    margin: 0;
    font-family: Arial;
    background: #0f172a;
    color: white;
}
.container {
    max-width: 420px;
    margin: auto;
    padding: 20px;
}
.card {
    background: #1e293b;
    padding: 15px;
    border-radius: 10px;
    margin-top: 20px;
}
input, button {
    width: 100%;
    padding: 10px;
    margin-top: 8px;
    border-radius: 5px;
    border: none;
}
button {
    background: #22c55e;
    font-weight: bold;
    cursor: pointer;
}
#chat { display: none; }
#mensagens {
    height: 200px;
    overflow-y: auto;
    background: #020617;
    padding: 10px;
    border-radius: 5px;
}
.friend {
    background: #334155;
    padding: 5px;
    margin-top: 5px;
    border-radius: 5px;
}
</style>
</head>

<body>

<div class="container">

<div class="card" id="loginCard">
    <h2>Login</h2>
    <input id="email" placeholder="Email">
    <input id="senha" type="password" placeholder="Senha (m√≠n. 6)">
    <button onclick="entrar()">Entrar</button>
    <button onclick="cadastrar()">Cadastrar</button>
</div>

<div class="card" id="chat">
    <h3 id="userEmail"></h3>
    <button onclick="sair()">Sair</button>

    <h4>Amigos</h4>
    <input id="emailAmigo" placeholder="Email do amigo">
    <button onclick="addAmigo()">Adicionar</button>
    <div id="listaAmigos"></div>

    <h4>Chat p√∫blico</h4>
    <div id="mensagens"></div>
    <input id="msg" placeholder="Mensagem">
    <button onclick="enviar()">Enviar</button>
</div>

</div>

<script>
// üî• CONFIGURA√á√ÉO CORRETA DO FIREBASE
const firebaseConfig = {
  apiKey: "AIzaSyDdEzkTOfqlh05D_ls0juTNAlALyc8bFxI",
  authDomain: "mini-chat-4c58f.firebaseapp.com",
  databaseURL: "https://mini-chat-4c58f-default-rtdb.firebaseio.com",
  projectId: "mini-chat-4c58f",
  storageBucket: "mini-chat-4c58f.appspot.com",
  messagingSenderId: "541279607046",
  appId: "1:541279607046:web:7fe7064bae40bffe64a687"
};

// INICIALIZA
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();

let uid = "";

// LOGIN
function entrar() {
  auth.signInWithEmailAndPassword(email.value, senha.value)
    .catch(e => alert(e.message));
}

// CADASTRO
function cadastrar() {
  auth.createUserWithEmailAndPassword(email.value, senha.value)
    .catch(e => alert(e.message));
}

// USU√ÅRIO LOGADO
auth.onAuthStateChanged(user => {
  if (user) {
    uid = user.uid;
    loginCard.style.display = "none";
    chat.style.display = "block";
    userEmail.innerText = user.email;
    carregarMensagens();
    carregarAmigos();
  }
});

// SAIR
function sair() {
  auth.signOut().then(() => location.reload());
}

// ENVIAR MENSAGEM
function enviar() {
  if (msg.value === "") return;
  db.ref("mensagens").push({
    user: auth.currentUser.email,
    texto: msg.value
  });
  msg.value = "";
}

// CARREGAR MENSAGENS
function carregarMensagens() {
  mensagens.innerHTML = "";
  db.ref("mensagens").on("child_added", s => {
    let m = s.val();
    mensagens.innerHTML += `<p><b>${m.user}:</b> ${m.texto}</p>`;
    mensagens.scrollTop = mensagens.scrollHeight;
  });
}

// AMIGOS
function addAmigo() {
  if (emailAmigo.value === "") return;
  db.ref("amigos/" + uid).push(emailAmigo.value);
  emailAmigo.value = "";
}

function carregarAmigos() {
  listaAmigos.innerHTML = "";
  db.ref("amigos/" + uid).on("child_added", s => {
    listaAmigos.innerHTML += `<div class="friend">${s.val()}</div>`;
  });
}
</script>

</body>
</html>

